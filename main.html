<!DOCTYPE html>
<html>
	<head>
		<title>Photobooth</title>
		<script src="js/jquery-3.2.1.min.js"></script>
  		<link rel="stylesheet" href="css/style.css"/>
  		<link rel="stylesheet" href="css/pure-min.css"/>
	</head>
	
	<body>
		<div class="pure-g">
			<div class="pure-u-1-6"></div>
			<div class="pure-u-2-3">
				<div id='preview-container'>
					<img id="preview" alt="Klicke auf 'Neue Vorschau um zu starten'" src="" style="width: 30%;" />
				</div>
			</div>
			<div class="pure-u-1-6">
				<button class='pure-button' type='button' id="shoot">Bild machen</button>
				<button class='pure-button' type="button" id="pre">Neue Vorschau</button>
			</div>
		</div>
	
		<div class="pure-g">
			<div class="pure-u-1-6"></div>
			<div class="pure-u-2-3 settings">
				<div class="pure-g">
					<div class="pure-u-1-2">
						<form class="pure-form pure-form-stacked" action="http://raspberrypi:8000" method="POST" id='rgbForm'>
							<select id="parameter" name='parameter' >
							</select><br />
							<select id="value" name='value' >
							</select><br />
							<button class='pure-button' type='button' id="send">Senden</button>
						</form>
					</div>
					<div class="pure-u-1-2">
						<form class="pure-form pure-form-stacked" action="http://raspberrypi:8000" method="POST" id='shootForm'>
							<input id="capture" name='capture' type="number" value=1 >
							<label for="capture">Timer</label>
							<a class='pure-button' href="gallery.html">Zur Gallerie</a>
						</form>
					</div>
				</div>
			</div>
			<div class="pure-u-1-6"></div>
		</div>
		
		
		
		<script>
			$('#send').click(function() {
				$.ajax({
					method: "POST",
					url: "http://raspberrypi:8000",
					data: $('#rgbForm').serialize()
				}).done( function (msg) {
					alert(msg.status);
				});
			});
			/*
			$('#pre').click(function() {
				$.ajax({
					method: "GET",
					url: "http://raspberrypi:8000/pre"
				}).done( function (msg) {
					var i = Math.floor(Math.random() * 20000);
					console.log(i);
					$('#preview').attr("src", msg.image + "?" + i);
				});
			});*/
			$('#pre').click(function() {
				$.ajax({
					method: "GET",
					url: "http://raspberrypi:8000/start"
				});
			});
			
			$('#shoot').click(function() {
				$.ajax({
					method: "POST",
					url: "http://raspberrypi:8000",
					data: $('#shootForm').serialize()
				}).done( function (msg) {
					location.href = "http://raspberrypi:8000/index.html";
				});
			});
			
			var settings;
			
			$(document).ready(function () {
				$.ajax({
					method: "POST",
					url: "http://raspberrypi:8000/settings"
				}).done( function (msg) {
					settings = msg.settings;
					
					for (var property in settings) {
						if (settings.hasOwnProperty(property)) {
							
							$('#parameter').append('<option id="' + property + '" value="' + property + '">' + settings[property].type + '</option>');
						}
					}
					
					$('#parameter').change(function () {
						$('#value').html("");
						for (key in settings[$('#parameter').val()].options) {
							$('#value').append('<option value="' + key + '" >' + settings[$('#parameter').val()].options[key] + '</option>');
						}
					});
				});
				
				var counter = 0;
				setInterval(function () {
					$('#preview').attr("src", "http://raspberrypi:8000/buffer" + "?" + counter);
					counter = counter + 1;
				}, 100);
			});
	</script>	
	
		
	</body>
</html>
